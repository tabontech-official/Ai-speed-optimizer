<!-- Wishlist App Enable Flag -->
<meta name="wishlist-app-enabled" content="true">
<script>
  window.WishlistAppEnabled = true;
</script>

{%- comment -%}
  Pagespeed Optimization Setup
{%- endcomment -%}

{% assign pagespeed_template_suffix_liquid = template.suffix | append: ".liquid" %}
{% assign pagespeed_page_type = template.name | replace: pagespeed_template_suffix_liquid, "" %}

{% unless request.page_type == 'customers/register' or request.page_type == 'captcha' or request.path contains 'contact' %}
  {%- if blank -%}
    <!-- Worker-based async loader -->
    <script type="text/javascript">
      var flspdx = new Worker("data:text/javascript;base64," + btoa('onmessage=function(e){var t=new Request("https://cdn.shopify.com/s/files/1/0555/4726/5114/files/wrk.js?shop={{ shop.url }}",{redirect:"follow"});fetch(t).then(e=>e.text()).then(e=>{postMessage(e)})};'));
      flspdx.onmessage = function (t) {
        var e = document.createElement("script");
        e.type = "text/javascript";
        e.textContent = t.data;
        document.head.appendChild(e)
      };
      flspdx.postMessage("init");
    </script>

    <!-- Mutation Observer to delay 3rd party scripts -->
    <script type="text/javascript" data-flspd="1">
      var flspdxHA = ["hotjar","xklaviyo","recaptcha","gorgias","facebook.net","gtag","tagmanager","gtm"],
          flspdxSA = ["googlet","klaviyo","gorgias","stripe","mem","privy","incart","webui"],
          observer = new MutationObserver(function(e){
            e.forEach(function(e){
              e.addedNodes.forEach(function(e){
                if("SCRIPT"===e.tagName && 1===e.nodeType){
                  if(e.innerHTML.includes("asyncLoad") || "analytics"===e.className){
                    e.type="text/flspdscript";
                  } else {
                    for(var t=0;t<flspdxSA.length;t++) if(e.src.includes(flspdxSA[t])) return void(e.type="text/flspdscript");
                    for(var r=0;r<flspdxHA.length;r++) if(e.innerHTML.includes(flspdxHA[r])) return void(e.type="text/flspdscript");
                  }
                }
              })
            })
          }),
          ua=navigator.userAgent.toLowerCase();
      ua.match(new RegExp("chrome|firefox")) && -1===window.location.href.indexOf("no-optimization") && observer.observe(document.documentElement,{childList:!0,subtree:!0});
    </script>
  {%- endif -%}
{% endunless %}

<!-- External PageSpeed script -->
<script src="https://cdn.shopify.com/s/files/1/0555/4726/5114/files/pspd.js?shop={{ shop.url }}"></script>

{%- comment -%}
  Theme App Extension Schema
{%- endcomment -%}
{% schema %}
{
  "name": "AI - Page Speed Optimizer",
  "target": "head",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product",
      "autofill": true
    },
    {
      "type": "color",
      "id": "colour",
      "label": "Star Colour",
      "default": "#ff0000"
    }
  ]
}
{% endschema %}
